#!/usr/bin/env bash

. $HOME/.config/shell/rc.sh

seperator=' | '
widgets=()

w_battery() {
	# Change BAT1 to whatever your battery is identified as. Typically BAT0 or BAT1
	charge=$(cat /sys/class/power_supply/BAT0/capacity 2>/dev/null)
	status=$(cat /sys/class/power_supply/BAT0/status 2>/dev/null)

	if [ -z $status ]; then
		return
	fi

	if [ "$status" = "Charging" ]; then
		printf "ğŸ”Œ %s%% %s" "$charge" "$status"
	else
		printf "ğŸ”‹ %s%% %s" "$charge" "$status"
	fi
}

w_date() {
	printf "ğŸ“† %s" "$(date "+%a %d-%m-%y %T")"
}

get_bar() {
	index=0
	for widget in ${widgets[@]}; do
		if [ $index -ne 0 ]; then
			printf "%s" "$seperator"
		fi

		w_$widget

		index=$((index + 1))
	done
}

set_widgets() {
	if is_laptop; then
		widgets=('battery' 'date')
	else
		widgets=('date')
	fi
}

main() {
	set_widgets

	while true; do
		res=$(get_bar)
		echo "$res"
		sleep 1
	done
}

main
