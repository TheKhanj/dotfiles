#!/usr/bin/env sh

get_random_move() {
	local num=$(awk 'BEGIN { srand(); print int(rand() * 5) }')

	case "$num" in
	0) echo w ;;
	1) echo a ;;
	2) echo s ;;
	3) echo d ;;
	4) echo space ;;
	esac
}

get_random_time() {
	awk -v min=0.3 -v max=3 'BEGIN { srand(); print min + (max - min) * rand() }'
}

move() {
	local win_id=$1

	while true; do
		local move=$(get_random_move)

		xdotool keydown --window $win_id $move
		sleep $(get_random_time)
		xdotool keyup --window $win_id $move

		sleep 1
	done
}

nums() {
	local win_id=$1

	while true; do
		local move=$(seq 3 | shuf | head -n 1)

		xdotool keydown --window $win_id $move

		sleep 30
	done
}

mouse() {
	local win_id=$1

	while true; do
		local move=$(get_random_move)

		xdotool mousedown --window $win_id 1
		sleep $(get_random_time)
		xdotool mouseup --window $win_id 1

		sleep 1
	done
}

main() {
	local win_id="$(wmctrl -l | grep 'Counter-Strike Source - Vulkan - 64 Bit' | awk '{ print $1 }')"

	move $win_id &
	local pid1=$!

	mouse $win_id &
	local pid2=$!

	nums $win_id &
	local pid3=$!

	wait $pid1 $pid2 $pid3
}

main
